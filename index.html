<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Promar Sipari≈ü & Teklif Platformu (Cloud)</title>
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2983/2983707.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                    }
                }
            }
        }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; }
        @media print {
            :root { color-scheme: light; }
            html, body, .dark, body.dark, #root { background-color: #ffffff !important; color: #000000 !important; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            @page { size: A4; margin: 10mm; }
            tr { page-break-inside: avoid; }
            .overflow-x-auto { overflow-x: visible !important; }
        }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300 select-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- FIREBASE AYARLARI (BURAYI KENDƒ∞ PROJENƒ∞ZE G√ñRE DOLDURUN) ---
        // Firebase Console -> Project Settings -> General -> Your Apps kƒ±smƒ±ndan alabilirsiniz.
const firebaseConfig = {
  apiKey: "AIzaSyDsgmQcL0FIKdZMVO1kljOud0AhiXzMQbQ",
  authDomain: "pricebook-2442c.firebaseapp.com",
  projectId: "pricebook-2442c",
  storageBucket: "pricebook-2442c.firebasestorage.app",
  messagingSenderId: "460551609784",
  appId: "1:460551609784:web:07030049d6e54c63cec34d"
};


        // Firebase Ba≈ülatma (Hata √∂nleyici kontrol ile)
        let db = null;
        try {
            if (firebase.apps.length === 0) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
        } catch (e) {
            console.warn("Firebase ba≈ülatƒ±lamadƒ±. Config ayarlarƒ±nƒ± kontrol edin.", e);
        }

        // --- ƒ∞KONLAR ---
        const IconWrapper = ({ children, size = 24, className = "", onClick }) => (
            <svg onClick={onClick} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{cursor: onClick ? 'pointer' : 'inherit'}}>{children}</svg>
        );
        const ShoppingCart = (props) => <IconWrapper {...props}><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></IconWrapper>;
        const FileText = (props) => <IconWrapper {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconWrapper>;
        const Search = (props) => <IconWrapper {...props}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></IconWrapper>;
        const ArrowLeft = (props) => <IconWrapper {...props}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></IconWrapper>;
        const Printer = (props) => <IconWrapper {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></IconWrapper>;
        const Trash2 = (props) => <IconWrapper {...props}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconWrapper>;
        const Package = (props) => <IconWrapper {...props}><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></IconWrapper>;
        const RefreshCw = (props) => <IconWrapper {...props}><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></IconWrapper>;
        const Sun = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></IconWrapper>;
        const Moon = (props) => <IconWrapper {...props}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></IconWrapper>;
        const Settings = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></IconWrapper>;
        const UploadCloud = (props) => <IconWrapper {...props}><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/><polyline points="16 16 12 12 8 16"/></IconWrapper>;
        const FileSpreadsheet = (props) => <IconWrapper {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></IconWrapper>;
        const Database = (props) => <IconWrapper {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></IconWrapper>;
        const LogOut = (props) => <IconWrapper {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></IconWrapper>;
        const Lock = (props) => <IconWrapper {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></IconWrapper>;
        const ChevronRight = (props) => <IconWrapper {...props}><polyline points="9 18 15 12 9 6" /></IconWrapper>;
        const Cloud = (props) => <IconWrapper {...props}><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></IconWrapper>;
        const Save = (props) => <IconWrapper {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></IconWrapper>;
        const Clock = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></IconWrapper>;

        function DealerPlatform() {
            const [dealers, setDealers] = useState([]);
            const [brands, setBrands] = useState([]);
            const [products, setProducts] = useState([]);
            const [isDataLoaded, setIsDataLoaded] = useState(false);
            const [isLoadingData, setIsLoadingData] = useState(false); // Veri y√ºkleniyor animasyonu

            const [darkMode, setDarkMode] = useState(true);
            const [selectedDealer, setSelectedDealer] = useState(null);
            const [activeBrand, setActiveBrand] = useState(null);
            const [activeCategory, setActiveCategory] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [viewMode, setViewMode] = useState('catalog');
            const [customerInfo, setCustomerInfo] = useState({ name: '', phone: '', email: '' });
            
            const [loginModal, setLoginModal] = useState({ open: false, dealer: null });
            const [passwordInput, setPasswordInput] = useState('');
            const [currency, setCurrency] = useState('EUR');
            const [exchangeRate, setExchangeRate] = useState(38.50);
            const [isLoadingRate, setIsLoadingRate] = useState(false);

            // Firebase Modal States
            const [showHistory, setShowHistory] = useState(false);
            const [proposalHistory, setProposalHistory] = useState([]);
            const [isSaving, setIsSaving] = useState(false);

            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                }
            }, [darkMode]);

            // --- OTOMATƒ∞K VERƒ∞ Y√úKLEME (AUTO LOAD) ---
            useEffect(() => {
                const autoLoadExcel = async () => {
                    // √ñnce local storage kontrol et
                    const storedDealers = localStorage.getItem('app_dealers');
                    if (storedDealers) {
                        try {
                            setDealers(JSON.parse(storedDealers));
                            setBrands(JSON.parse(localStorage.getItem('app_brands')));
                            setProducts(JSON.parse(localStorage.getItem('app_products')));
                            setIsDataLoaded(true);
                            return; 
                        } catch (e) { console.log("Cache hatasƒ±, webden √ßekiliyor..."); }
                    }

                    // Cache yoksa veya bozuksa GitHub/Localden √ßek
                    setIsLoadingData(true);
                    try {
                        // "data.xlsx" dosyasƒ±nƒ± aynƒ± dizinde ara
                        const response = await fetch('data.xlsx'); 
                        if (!response.ok) throw new Error("Dosya bulunamadƒ±");
                        
                        const arrayBuffer = await response.arrayBuffer();
                        processExcel(arrayBuffer);
                    } catch (error) {
                        console.log("Otomatik y√ºkleme yapƒ±lamadƒ±, manuel bekleniyor.", error);
                    } finally {
                        setIsLoadingData(false);
                    }
                };
                autoLoadExcel();
            }, []);

            const processExcel = (buffer) => {
                const wb = XLSX.read(buffer, { type: 'array' });
                const wsDealers = wb.Sheets[wb.SheetNames[0]];
                const wsBrands = wb.Sheets[wb.SheetNames[1]];
                const dataDealers = XLSX.utils.sheet_to_json(wsDealers);
                const dataBrands = XLSX.utils.sheet_to_json(wsBrands);

                let allProducts = [];
                for(let i = 2; i < wb.SheetNames.length; i++) {
                    const ws = wb.Sheets[wb.SheetNames[i]];
                    const data = XLSX.utils.sheet_to_json(ws);
                    allProducts = [...allProducts, ...data];
                }

                setDealers(dataDealers);
                setBrands(dataBrands);
                setProducts(allProducts);
                setIsDataLoaded(true);

                try {
                    localStorage.setItem('app_dealers', JSON.stringify(dataDealers));
                    localStorage.setItem('app_brands', JSON.stringify(dataBrands));
                    localStorage.setItem('app_products', JSON.stringify(allProducts));
                } catch (e) { console.log("Storage dolu"); }
            };

            const clearData = () => {
                if (confirm("Kayƒ±tlƒ± veriler silinecek. Onaylƒ±yor musunuz?")) {
                    localStorage.clear();
                    setIsDataLoaded(false);
                    setDealers([]);
                    window.location.reload();
                }
            };

            const processImageUrl = (url) => {
                if (!url) return '';
                if (url.includes('onedrive.live.com')) {
                    if (url.includes('redir')) return url.replace('redir', 'download');
                    if (url.includes('view.aspx')) return url.replace('view.aspx', 'download');
                }
                return url;
            };

            const getBrandName = (brandId) => {
                const b = brands.find(brand => brand.id == brandId);
                return b ? b.name : '-';
            };

            const handleFileUpload = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => processExcel(evt.target.result);
                reader.readAsArrayBuffer(file);
            };

            // --- FIREBASE ƒ∞≈ûLEMLERƒ∞ ---
            const saveProposalToFirebase = async () => {
                if (!db) { alert("Firebase baƒülantƒ±sƒ± yok! L√ºtfen config ayarlarƒ±nƒ± yapƒ±n."); return; }
                if (!customerInfo.name) { alert("L√ºtfen m√º≈üteri adƒ± giriniz."); return; }
                
                setIsSaving(true);
                try {
                    await db.collection("proposals").add({
                        dealerId: selectedDealer.id,
                        dealerName: selectedDealer.name,
                        customer: customerInfo,
                        cart: cart,
                        totalAmount: calculateTotal().finalTotal,
                        currency: currency,
                        date: new Date().toISOString(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert("Teklif buluta ba≈üarƒ±yla kaydedildi!");
                } catch (error) {
                    console.error("Hata:", error);
                    alert("Kaydedilirken hata olu≈ütu: " + error.message);
                } finally {
                    setIsSaving(false);
                }
            };

            const fetchProposalHistory = async () => {
                if (!db) return;
                if (!selectedDealer) return;

                const snapshot = await db.collection("proposals")
                    .where("dealerId", "==", selectedDealer.id)
                    .orderBy("createdAt", "desc")
                    .limit(20)
                    .get();

                const list = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setProposalHistory(list);
                setShowHistory(true);
            };

            const loadProposal = (proposal) => {
                if(confirm("Mevcut sepet silinecek ve se√ßilen teklif y√ºklenecek. Onaylƒ±yor musunuz?")) {
                    setCustomerInfo(proposal.customer);
                    setCart(proposal.cart);
                    setShowHistory(false);
                    setViewMode('proposal');
                }
            };

            // ... Diƒüer yardƒ±mcƒ± fonksiyonlar (Kur √ßekme, fiyat formatlama vs)
            const fetchTCMBRate = async () => {
                setIsLoadingRate(true);
                try {
                    const response = await fetch('https://api.frankfurter.app/latest?from=EUR&to=TRY');
                    const data = await response.json();
                    if (data?.rates?.TRY) setExchangeRate(data.rates.TRY);
                } catch (error) { console.error("Kur hatasƒ±:", error); } finally { setIsLoadingRate(false); }
            };
            useEffect(() => { fetchTCMBRate(); }, []);

            const formatPrice = (priceEur) => {
                const val = currency === 'EUR' ? priceEur : priceEur * exchangeRate;
                return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: currency }).format(val);
            };

            const calculateTotal = () => {
                const subTotal = cart.reduce((acc, item) => acc + (item.price * item.qty * (1 - (item.discount || 0) / 100)), 0);
                const kdvAmount = subTotal * 0.20;
                return { subTotal, kdvAmount, finalTotal: subTotal + kdvAmount };
            };

            // Yetki ve Filtreleme
            const visibleBrands = useMemo(() => {
                if (!selectedDealer) return [];
                if (!selectedDealer.allowedBrands) return brands;
                const allowedIds = String(selectedDealer.allowedBrands).replace(/\./g, ',').split(',').map(s => s.trim());
                return brands.filter(b => allowedIds.includes(b.id.toString()));
            }, [brands, selectedDealer]);

            const filteredProducts = useMemo(() => {
                let data = products;
                if (activeBrand) data = data.filter(p => p.brandId === activeBrand);
                if (activeCategory) data = data.filter(p => p.category === activeCategory);
                if (searchQuery.trim() !== '') {
                    const q = searchQuery.toLowerCase();
                    data = data.filter(p => (p.name?.toLowerCase().includes(q)) || (p.partNo?.toLowerCase().includes(q)));
                    if (selectedDealer && selectedDealer.allowedBrands) {
                        const allowedIds = String(selectedDealer.allowedBrands).replace(/\./g, ',').split(',').map(s => s.trim());
                        data = data.filter(p => allowedIds.includes(p.brandId.toString()));
                    }
                }
                return data;
            }, [activeBrand, searchQuery, products, activeCategory, selectedDealer]);

            const availableCategories = useMemo(() => {
                let data = products;
                if (activeBrand) data = data.filter(p => p.brandId === activeBrand);
                const cats = [...new Set(data.map(p => p.category).filter(c => c && typeof c === 'string'))];
                return cats.sort();
            }, [products, activeBrand]);

            const addToCart = (product) => {
                setCart(prev => {
                    const existing = prev.find(item => item.partNo === product.partNo);
                    if (existing) return prev.map(item => item.partNo === product.partNo ? { ...item, qty: item.qty + 1 } : item);
                    return [...prev, { ...product, qty: 1, discount: 0 }];
                });
            };

            const removeFromCart = (partNo) => setCart(prev => prev.filter(item => item.partNo !== partNo));
            const updateQty = (partNo, delta) => setCart(prev => prev.map(item => item.partNo === partNo ? { ...item, qty: Math.max(1, item.qty + delta) } : item));
            const updateItemDiscount = (partNo, discount) => setCart(prev => prev.map(item => item.partNo === partNo ? { ...item, discount: Math.min(100, Math.max(0, discount)) } : item));

            const handleDealerClick = (dealer) => {
                if (dealer.password && dealer.password.toString().trim() !== '') {
                    setLoginModal({ open: true, dealer });
                    setPasswordInput('');
                } else { setSelectedDealer(dealer); }
            };
            const handleLoginSubmit = (e) => {
                e.preventDefault();
                if (loginModal.dealer && loginModal.dealer.password.toString() === passwordInput) {
                    setSelectedDealer(loginModal.dealer);
                    setLoginModal({ open: false, dealer: null });
                } else { alert("Hatalƒ± Parola!"); }
            };

            const sendToWhatsapp = () => {
                if (!customerInfo.phone) { alert('Telefon giriniz.'); return; }
                const { finalTotal } = calculateTotal();
                let msg = `*Sƒ∞PARƒ∞≈û*\nBayi: ${selectedDealer.name}\nM√º≈üteri: ${customerInfo.name}\n\n`;
                cart.forEach(i => msg += `${i.name} (${i.qty} Ad.)\n`);
                msg += `\n*Toplam:* ${formatPrice(finalTotal)}`;
                window.open(`https://wa.me/${customerInfo.phone.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const { subTotal, kdvAmount, finalTotal } = calculateTotal();

            return (
                <div className="min-h-screen bg-gray-50 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300 font-sans">
                    
                    {/* Y√úKLENƒ∞YOR EKRANI */}
                    {isLoadingData && (
                        <div className="fixed inset-0 bg-black/80 z-[100] flex flex-col items-center justify-center text-white">
                            <RefreshCw className="w-12 h-12 animate-spin mb-4 text-blue-500" />
                            <h2 className="text-xl font-bold">Veriler Buluttan √áekiliyor...</h2>
                            <p className="text-sm text-gray-400">data.xlsx dosyasƒ± y√ºkleniyor</p>
                        </div>
                    )}

                    {/* HISTORY MODAL */}
                    {showHistory && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                            <div className="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-2xl w-full max-w-2xl border dark:border-gray-700 h-3/4 flex flex-col">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold dark:text-white flex items-center gap-2"><Clock /> Ge√ßmi≈ü Teklifler</h3>
                                    <button onClick={() => setShowHistory(false)}><X /></button>
                                </div>
                                <div className="flex-1 overflow-y-auto space-y-3">
                                    {proposalHistory.length === 0 ? <p className="text-center text-gray-500 mt-10">Kayƒ±tlƒ± teklif bulunamadƒ±.</p> : 
                                     proposalHistory.map((prop, idx) => (
                                        <div key={idx} onClick={() => loadProposal(prop)} className="p-4 border dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer flex justify-between items-center group">
                                            <div>
                                                <p className="font-bold">{prop.customer?.name || 'ƒ∞simsiz M√º≈üteri'}</p>
                                                <p className="text-xs text-gray-500">{new Date(prop.date).toLocaleString('tr-TR')}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-bold text-blue-600">{new Intl.NumberFormat('tr-TR', { style: 'currency', currency: prop.currency || 'EUR' }).format(prop.totalAmount)}</p>
                                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded group-hover:bg-blue-600 group-hover:text-white transition">Y√ºkle</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* LOGIN MODAL */}
                    {loginModal.open && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                            <form onSubmit={handleLoginSubmit} className="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-2xl w-full max-w-sm border dark:border-gray-700">
                                <h3 className="text-xl font-bold mb-1 dark:text-white">{loginModal.dealer?.name}</h3>
                                <p className="text-sm text-gray-500 mb-4">L√ºtfen bayi giri≈ü parolasƒ±nƒ± giriniz.</p>
                                <input autoFocus type="password" className="w-full p-3 border rounded-lg mb-4 bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 ring-blue-500 outline-none" placeholder="Parola" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} />
                                <div className="flex gap-2">
                                    <button type="button" onClick={() => setLoginModal({open:false, dealer:null})} className="flex-1 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 dark:text-white">ƒ∞ptal</button>
                                    <button type="submit" className="flex-1 py-2 rounded-lg bg-blue-600 text-white font-bold">Giri≈ü Yap</button>
                                </div>
                            </form>
                        </div>
                    )}

                    {!isDataLoaded ? (
                        <div className="flex flex-col items-center justify-center min-h-screen p-4 bg-gray-100 dark:bg-gray-900">
                            <div className="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl max-w-lg w-full text-center border border-gray-200 dark:border-gray-700">
                                <div className="bg-blue-100 dark:bg-blue-900 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <Cloud className="w-10 h-10 text-blue-600 dark:text-blue-300" />
                                </div>
                                <h1 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">Otomatik Y√ºkleme Ba≈üarƒ±sƒ±z</h1>
                                <p className="text-gray-500 dark:text-gray-400 mb-4">
                                    'data.xlsx' dosyasƒ± bulunamadƒ±. Manuel y√ºkleyebilirsiniz.
                                </p>
                                <label className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition">
                                    <div className="flex flex-col items-center justify-center pt-5 pb-6">
                                        <UploadCloud className="w-10 h-10 mb-3 text-gray-400" />
                                        <p className="mb-2 text-sm text-gray-500 dark:text-gray-400"><span className="font-semibold">Dosya se√ßin</span></p>
                                    </div>
                                    <input type="file" className="hidden" accept=".xlsx, .xls" onChange={handleFileUpload} />
                                </label>
                            </div>
                        </div>
                    ) : !selectedDealer ? (
                        <div className="flex flex-col items-center justify-center min-h-screen p-4 animate-in fade-in duration-500">
                            <div className="max-w-6xl w-full">
                                <div className="flex justify-between items-center mb-8">
                                    <button onClick={clearData} className="text-sm text-red-500 hover:text-red-700 flex items-center gap-1 bg-white dark:bg-gray-800 px-3 py-2 rounded shadow"><Database size={14} /> Veri Sƒ±fƒ±rla</button>
                                    <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded-full bg-gray-200 dark:bg-gray-700">{darkMode ? <Sun size={20} className="text-yellow-400" /> : <Moon size={20} className="text-gray-600" />}</button>
                                </div>
                                <h1 className="text-3xl font-bold text-center text-gray-800 dark:text-white mb-2">Ho≈ügeldiniz</h1>
                                <p className="text-center text-gray-500 dark:text-gray-400 mb-8">Giri≈ü yapacaƒüƒ±nƒ±z bayiyi se√ßiniz.</p>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    {dealers.map((dealer, idx) => (
                                        <button key={idx} onClick={() => handleDealerClick(dealer)} className="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-1 transition border border-gray-200 dark:border-gray-700 flex flex-col items-center text-center group relative overflow-hidden">
                                            {dealer.password && <div className="absolute top-3 right-3 text-gray-300 dark:text-gray-600"><Lock size={16} /></div>}
                                            <div className="w-full h-32 mb-4 flex items-center justify-center bg-gray-50 dark:bg-gray-700 rounded-lg overflow-hidden p-2">
                                                {dealer.logo && (dealer.logo.startsWith('http') || dealer.logo.startsWith('data:')) ? <img src={processImageUrl(dealer.logo)} alt={dealer.name} className="w-full h-full object-contain" onError={(e)=>{e.target.style.display='none';e.target.nextElementSibling?.classList.remove('hidden');}} /> : <span className="text-6xl">{dealer.logo || 'üè¢'}</span>}
                                                <span className="hidden text-6xl absolute">üè¢</span>
                                            </div>
                                            <h3 className="text-xl font-bold text-gray-800 dark:text-white">{dealer.name}</h3>
                                            <p className="text-sm text-gray-500 dark:text-gray-400 mt-2">{dealer.city}</p>
                                            {dealer.address && <p className="text-xs text-gray-400 dark:text-gray-500 mt-1 line-clamp-1 px-4">{dealer.address}</p>}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="flex flex-col h-screen overflow-hidden animate-in slide-in-from-right duration-300">
                            
                            <header className="bg-white dark:bg-gray-800 shadow-sm z-30 px-4 py-3 shrink-0 border-b dark:border-gray-700 no-print">
                                <div className="max-w-7xl mx-auto flex flex-col md:flex-row gap-4 items-center justify-between">
                                    <div className="flex items-center gap-3 w-full md:w-auto">
                                        {viewMode === 'proposal' ? (
                                            <button onClick={() => setViewMode('catalog')} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><ArrowLeft className="w-6 h-6" /></button>
                                        ) : (activeBrand || searchQuery) ? (
                                            <button onClick={() => { setActiveBrand(null); setActiveCategory(null); setSearchQuery(''); }} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><ArrowLeft className="w-6 h-6" /></button>
                                        ) : (
                                            <div className="flex gap-2">
                                                <button onClick={() => setSelectedDealer(null)} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-xs flex flex-col items-center text-gray-400"><LogOut size={16} /> <span className="text-[10px]">√áƒ±kƒ±≈ü</span></button>
                                                {/* GE√áMƒ∞≈û BUTONU */}
                                                <button onClick={fetchProposalHistory} className="p-2 hover:bg-blue-100 dark:hover:bg-blue-900 rounded-full text-xs flex flex-col items-center text-blue-600 dark:text-blue-400 font-bold"><Clock size={16} /> <span className="text-[10px]">Ge√ßmi≈ü</span></button>
                                            </div>
                                        )}
                                        <div>
                                            <h1 className="text-lg font-bold leading-tight">{viewMode === 'proposal' ? 'Teklif Hazƒ±rlama' : (searchQuery ? 'Arama Sonu√ßlarƒ±' : (activeBrand ? brands.find(b => b.id === activeBrand)?.name : selectedDealer.name))}</h1>
                                        </div>
                                    </div>

                                    {viewMode === 'catalog' && (
                                        <div className="flex-1 max-w-md w-full relative">
                                            <div className="absolute left-3 top-2.5 text-gray-400"><Search size={16}/></div>
                                            <input type="text" value={searchQuery} onChange={(e) => { setSearchQuery(e.target.value); if(e.target.value) { setActiveBrand(null); setActiveCategory(null); }}} placeholder="√úr√ºn ara..." className="w-full pl-9 pr-3 py-2 bg-gray-100 dark:bg-gray-700 dark:text-white rounded-lg border-none focus:ring-2 focus:ring-blue-500 text-sm outline-none transition" />
                                        </div>
                                    )}

                                    <div className="flex items-center gap-3 w-full md:w-auto justify-end">
                                        <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">{darkMode ? <Sun size={18} /> : <Moon size={18} />}</button>
                                        <div className="flex items-center bg-gray-100 dark:bg-gray-700 rounded-lg p-1 gap-1">
                                            <button onClick={() => setCurrency('EUR')} className={`px-2 py-1 text-xs font-bold rounded ${currency === 'EUR' ? 'bg-white text-blue-600 shadow' : 'text-gray-500'}`}>‚Ç¨</button>
                                            <button onClick={() => setCurrency('TRY')} className={`px-2 py-1 text-xs font-bold rounded ${currency === 'TRY' ? 'bg-white text-blue-600 shadow' : 'text-gray-500'}`}>‚Ç∫</button>
                                            <div onClick={fetchTCMBRate} className="pl-2 border-l border-gray-300 dark:border-gray-600 min-w-[60px] text-center cursor-pointer">{isLoadingRate ? <RefreshCw className="w-3 h-3 animate-spin inline" /> : <span className="text-xs font-mono font-bold">{exchangeRate.toFixed(2)}</span>}</div>
                                        </div>
                                        {viewMode === 'catalog' && (
                                            <button onClick={() => setIsCartOpen(true)} className="relative p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
                                                <ShoppingCart className="w-6 h-6" />
                                                {cart.length > 0 && <span className="absolute top-0 right-0 bg-red-500 text-white text-[10px] w-4 h-4 flex items-center justify-center rounded-full font-bold">{cart.length}</span>}
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </header>

                            {viewMode === 'catalog' ? (
                                <div className="flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900">
                                    <div className="max-w-7xl mx-auto">
                                        
                                        {!activeBrand && !searchQuery && (
                                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                                {visibleBrands.length > 0 ? visibleBrands.map((brand, idx) => (
                                                    <button key={idx} onClick={() => { setActiveBrand(brand.id); setActiveCategory(null); }} className="group bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-xl hover:-translate-y-1 transition flex flex-col items-center justify-center aspect-square relative">
                                                        <div className={`w-full h-3/4 ${brand.color || 'bg-gray-50 dark:bg-gray-700'} rounded-xl flex items-center justify-center mb-4 p-4 overflow-hidden relative`}>
                                                            {brand.logo && (brand.logo.startsWith('http') || brand.logo.startsWith('data:')) ? <img src={processImageUrl(brand.logo)} alt={brand.name} className="w-full h-full object-contain" onError={(e)=>{e.target.style.display='none';e.target.nextElementSibling?.classList.remove('hidden');}} /> : brand.logo}
                                                            <span className="hidden absolute text-3xl font-bold">{brand.name?brand.name.substring(0,1):'M'}</span>
                                                        </div>
                                                        <h3 className="text-xl font-bold text-gray-800 dark:text-white group-hover:text-blue-600 transition">{brand.name}</h3>
                                                        <span className="text-sm text-gray-400 mt-1">G√∂zat</span>
                                                    </button>
                                                )) : (
                                                    <div className="col-span-full text-center py-20 text-gray-400"><Lock className="w-16 h-16 mx-auto mb-4 opacity-50"/>Bu bayi i√ßin tanƒ±mlƒ± marka bulunamadƒ±.</div>
                                                )}
                                            </div>
                                        )}

                                        {(activeBrand || (availableCategories.length > 0 && searchQuery)) && (
                                            <div className="mb-6 flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                                                <button onClick={() => setActiveCategory(null)} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition border ${!activeCategory ? 'bg-blue-600 text-white border-blue-600' : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300'}`}>T√ºm√º</button>
                                                {availableCategories.map((cat, idx) => (
                                                    <button key={idx} onClick={() => setActiveCategory(cat)} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition border ${activeCategory === cat ? 'bg-blue-600 text-white border-blue-600' : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300'}`}>{cat}</button>
                                                ))}
                                            </div>
                                        )}

                                        {(activeBrand || searchQuery) && (
                                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                                {filteredProducts.map((product, idx) => (
                                                    <div key={idx} className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 flex flex-row sm:flex-col overflow-hidden h-auto min-h-[9rem] sm:h-auto group hover:shadow-md transition">
                                                        <div className="w-28 sm:w-full sm:h-48 bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-4xl shrink-0 relative overflow-hidden">
                                                            {product.image && (product.image.startsWith('http') || product.image.startsWith('data:')) ? 
                                                                <img src={processImageUrl(product.image)} alt={product.name} className="w-full h-full object-cover" onError={(e)=>{e.target.style.display='none';e.target.parentElement.innerHTML = '<span class="text-gray-300">üì¶</span>'; }} /> : <Package className="text-gray-300" size={40} />
                                                            }
                                                            <div className="absolute top-2 right-2 bg-white/90 dark:bg-black/70 backdrop-blur px-2 py-0.5 rounded text-[10px] font-mono text-gray-600 dark:text-gray-300 border dark:border-gray-600">{product.partNo}</div>
                                                        </div>
                                                        <div className="p-3 flex flex-col justify-between flex-1">
                                                            <div>
                                                                {product.category && <span className="text-[10px] font-bold uppercase text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-1.5 py-0.5 rounded inline-block mb-1">{product.category}</span>}
                                                                <h3 className="font-semibold text-gray-800 dark:text-gray-100 text-sm line-clamp-2 leading-tight">{product.name}</h3>
                                                            </div>
                                                            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mt-3 gap-2">
                                                                <span className="font-bold text-blue-700 dark:text-blue-400 text-lg">{formatPrice(product.price)}</span>
                                                                <button onClick={() => addToCart(product)} className="w-full sm:w-auto bg-blue-600 text-white py-2 px-4 sm:p-2 rounded-lg hover:bg-blue-700 active:scale-95 transition shadow-sm text-center">
                                                                    <span className="text-sm sm:text-xs font-bold">Sepete Ekle</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                                {filteredProducts.length === 0 && (
                                                    <div className="col-span-full text-center py-20 text-gray-400"><Package className="w-16 h-16 mx-auto mb-4 opacity-50"/><p>√úr√ºn bulunamadƒ±.</p></div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ) : (
                                <div className="flex-1 overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4 print:p-0 print:bg-white flex justify-center">
                                    <div className="proposal-container bg-white w-full max-w-4xl shadow-xl rounded-xl overflow-hidden print:shadow-none print:w-full flex flex-col h-fit">
                                        
                                        <div className="bg-gray-800 text-white p-6 no-print">
                                            <h2 className="text-xl font-bold flex items-center gap-2 mb-4"><Settings size={20} /> Teklif Ayarlarƒ±</h2>
                                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                                <input type="text" placeholder="M√º≈üteri Adƒ± *" className="p-2 rounded text-gray-900 text-sm" value={customerInfo.name} onChange={e => setCustomerInfo({...customerInfo, name: e.target.value})} />
                                                <input type="text" placeholder="Telefon (5XX...)" className="p-2 rounded text-gray-900 text-sm" value={customerInfo.phone} onChange={e => setCustomerInfo({...customerInfo, phone: e.target.value})} />
                                                
                                                {/* KAYDET BUTONU */}
                                                <button onClick={saveProposalToFirebase} disabled={isSaving} className="bg-green-600 hover:bg-green-500 text-white p-2 rounded font-bold flex items-center justify-center gap-2 transition disabled:opacity-50">
                                                    {isSaving ? <RefreshCw className="animate-spin" size={16} /> : <Save size={16} />} 
                                                    {isSaving ? 'Kaydediliyor...' : 'Buluta Kaydet'}
                                                </button>

                                                <button onClick={sendToWhatsapp} disabled={!customerInfo.phone} className={`p-2 rounded font-bold flex items-center justify-center gap-2 transition ${customerInfo.phone ? 'bg-green-600 hover:bg-green-500 text-white' : 'bg-gray-600 text-gray-400 cursor-not-allowed'}`}><Phone size={16} /> WhatsApp</button>
                                                <button onClick={() => window.print()} className="bg-blue-600 hover:bg-blue-500 text-white p-2 rounded font-bold flex items-center justify-center gap-2 transition"><Printer size={16} /> PDF ƒ∞ndir</button>
                                            </div>
                                        </div>

                                        <div className="p-10 print:p-0 print:m-0 text-gray-900 print:w-full">
                                            
                                            <div className="flex justify-between items-end border-b-2 border-gray-800 pb-4 mb-6 print:mb-4">
                                                <div className="flex items-center gap-4">
                                                    <div className="h-24 w-40 flex items-center justify-start overflow-hidden">
                                                        {selectedDealer.logo && (selectedDealer.logo.startsWith('http') || selectedDealer.logo.startsWith('data:')) ? 
                                                            <img src={processImageUrl(selectedDealer.logo)} alt="Logo" className="max-h-full max-w-full object-contain" /> : <span className="text-4xl">üè¢</span>}
                                                    </div>
                                                    <div>
                                                        <h1 className="text-2xl font-bold uppercase">{selectedDealer.name}</h1>
                                                        {selectedDealer.address && <p className="text-sm text-gray-600 max-w-[250px]">{selectedDealer.address}</p>}
                                                        <p className="text-sm text-gray-600 max-w-[250px]">{selectedDealer.city} - {selectedDealer.phone}</p>
                                                        <p className="text-xs text-gray-500">{selectedDealer.email}</p>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <h2 className="font-bold text-4xl text-gray-800 mb-1">TEKLƒ∞F</h2>
                                                    <p className="text-sm mt-2"><strong>Tarih:</strong> {new Date().toLocaleDateString('tr-TR')}</p>
                                                    {customerInfo.name && <p className="text-sm"><strong>Sayƒ±n:</strong> {customerInfo.name}</p>}
                                                </div>
                                            </div>

                                            <div className="md:hidden no-print text-xs text-gray-400 text-right mb-1 flex items-center justify-end gap-1">
                                                <span>Tabloyu kaydƒ±rƒ±nƒ±z</span> <ChevronRight size={12}/>
                                            </div>

                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm mb-6 table-auto border-collapse min-w-[600px] md:min-w-0">
                                                    <thead className="bg-gray-100 border-b-2 border-gray-300 print:bg-gray-200">
                                                        <tr>
                                                            <th className="p-2 text-left w-10">#</th>
                                                            <th className="p-2 text-center w-14">G√∂rsel</th>
                                                            <th className="p-2 text-left w-24">Marka</th>
                                                            <th className="p-2 text-left">√úr√ºn Kodu / Adƒ±</th>
                                                            <th className="p-2 text-center w-12">Adet</th>
                                                            <th className="p-2 text-right w-24">Birim</th>
                                                            <th className="p-2 text-center w-16">ƒ∞sk.%</th>
                                                            <th className="p-2 text-right w-28">Tutar</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-gray-200">
                                                        {cart.map((item, idx) => (
                                                            <tr key={idx} className="break-inside-avoid">
                                                                <td className="p-2 text-center text-gray-500">{idx + 1}</td>
                                                                <td className="p-2 text-center">
                                                                    {item.image ? 
                                                                        <img src={processImageUrl(item.image)} className="w-10 h-10 object-contain mx-auto border rounded bg-white" alt="img" onError={(e) => e.target.style.display='none'} /> 
                                                                        : <span className="text-gray-300 text-xs">-</span>
                                                                    }
                                                                </td>
                                                                <td className="p-2 font-semibold text-gray-700">{getBrandName(item.brandId)}</td>
                                                                <td className="p-2">
                                                                    <div className="font-bold text-gray-800 text-xs">{item.partNo}</div>
                                                                    <div className="text-gray-600 text-sm whitespace-normal min-w-[150px]">{item.name}</div>
                                                                </td>
                                                                <td className="p-2 text-center font-bold">{item.qty}</td>
                                                                <td className="p-2 text-right text-gray-500 whitespace-nowrap">{formatPrice(item.price)}</td>
                                                                <td className="p-2 text-center">
                                                                    <input type="number" min="0" max="100" value={item.discount} onChange={(e) => updateItemDiscount(item.partNo, Number(e.target.value))} className="w-10 p-1 text-center border border-gray-300 rounded no-print bg-gray-50 text-xs" />
                                                                    <span className="hidden print:inline font-bold">{item.discount > 0 ? `%${item.discount}` : '-'}</span>
                                                                </td>
                                                                <td className="p-2 text-right font-bold text-gray-900 whitespace-nowrap">{formatPrice(item.price * item.qty * (1 - (item.discount || 0) / 100))}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>

                                            <div className="flex justify-end break-inside-avoid page-break-inside-avoid">
                                                <div className="w-72 space-y-2 border-t pt-4">
                                                    <div className="flex justify-between text-gray-600 border-b border-dashed pb-1"><span>Ara Toplam:</span><span>{formatPrice(subTotal)}</span></div>
                                                    <div className="flex justify-between text-gray-600 border-b border-dashed pb-1"><span>KDV (%20):</span><span>{formatPrice(kdvAmount)}</span></div>
                                                    <div className="flex justify-between text-xl font-bold text-gray-900 pt-2"><span>TOPLAM:</span><span>{formatPrice(finalTotal)}</span></div>
                                                </div>
                                            </div>
                                            
                                            <div className="mt-8 pt-4 border-t text-xs text-center text-gray-400 print:fixed print:bottom-4 print:left-0 print:w-full">
                                                Bu teklif <strong>Promar Sipari≈ü Sistemi</strong> ile olu≈üturulmu≈ütur.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {isCartOpen && (
                                <div className="fixed inset-0 z-50 flex justify-end font-sans no-print">
                                    <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setIsCartOpen(false)} />
                                    <div className="relative w-full max-w-md bg-white dark:bg-gray-800 shadow-2xl flex flex-col h-full animate-in slide-in-from-right duration-300">
                                        <div className="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-900">
                                            <h2 className="text-lg font-bold flex items-center gap-2 text-gray-800 dark:text-white">Sepetim ({cart.length})</h2>
                                            <button onClick={() => setIsCartOpen(false)} className="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full dark:text-gray-300"><X size={20} /></button>
                                        </div>
                                        <div className="flex-1 overflow-y-auto p-4 space-y-3">
                                            {cart.map((item, idx) => (
                                                <div key={idx} className="flex gap-3 p-3 bg-white dark:bg-gray-700 border border-gray-100 dark:border-gray-600 rounded-lg shadow-sm">
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex justify-between"><h4 className="font-semibold text-sm truncate dark:text-white">{item.name}</h4><span className="font-bold text-blue-600 dark:text-blue-400 text-sm">{formatPrice(item.price * item.qty)}</span></div>
                                                        <div className="flex items-center justify-between mt-2">
                                                            <div className="flex items-center bg-gray-100 dark:bg-gray-600 rounded"><button onClick={() => updateQty(item.partNo, -1)} className="px-2 py-0.5 dark:text-white">-</button><span className="text-xs font-bold px-2 dark:text-white">{item.qty}</span><button onClick={() => updateQty(item.partNo, 1)} className="px-2 py-0.5 dark:text-white">+</button></div>
                                                            <button onClick={() => removeFromCart(item.partNo)} className="text-red-400 hover:text-red-500"><Trash2 size={16} /></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                                            <div className="flex justify-between items-center mb-4 text-lg font-bold dark:text-white"><span>Toplam:</span><span className="text-blue-700 dark:text-blue-400">{formatPrice(finalTotal)}</span></div>
                                            <button onClick={() => { setIsCartOpen(false); setViewMode('proposal'); }} className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-bold shadow-lg transition flex justify-center items-center gap-2"><FileText size={18} /> Teklif Hazƒ±rla</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DealerPlatform />);
    </script>
</body>
</html>
